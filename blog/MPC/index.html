<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MPC on Jupyter Notebook with Matlab-kernel | PauLoMarconi</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://paulomarconi.github.io/blog/MPC/">
<link rel="icon" href="../../files/blogFavicon.ico" sizes="128x128">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.rawgit.com/jpswalsh/academicons/master/css/academicons.min.css">
<link rel="stylesheet" href="../../assets/css/prism.css">
<meta name="author" content="Paulo Loma Marconi">
<link rel="prev" href="../MPC-SSTO/" title="MPC with feed-forward SSTO" type="text/html">
<meta property="og:site_name" content="PauLoMarconi">
<meta property="og:title" content="MPC on Jupyter Notebook with Matlab-kernel">
<meta property="og:url" content="https://paulomarconi.github.io/blog/MPC/">
<meta property="og:description" content="Table of Contents
1  Unconstrained Model Predictive Control (MPC) on Jupyter Notebook2  Pre-requisites3  Background Theory4  Unconstrained MPC5  Problem Formulation6  Prediction matrices (predicted eq">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-09-23T19:17:08-04:00">
<link rel="stylesheet" href="../../assets/css/post_ipynb.css">
<link rel="stylesheet" href="../../assets/css/prism.css">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<!-- <nav class="navbar navbar-expand-md static-top mb-4 -->
<nav class="navbar navbar-expand-md sticky-top mb-4
navbar-dark bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href="../../">

            <span id="blog-title">PauLoMarconi</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="../../index.html" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Blog</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../bio/index.html" class="nav-link">Bio</a>
                </li>
<li class="nav-item">
<a href="../../cheatsheet/index.html" class="nav-link">Cheatsheet</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<!-- Google custom search --><form method="get" action="https://www.google.com/search" class="navbar-form navbar-right" role="search">
    <div class="input-group">
        <input type="text" name="q" class="form-control" placeholder="Search"><button type="submit" class="btn btn-secondary">
            <i class="fa fa-search"></i>
        </button>
        <input type="hidden" name="sitesearch" value="https://paulomarconi.github.io/">
</div>    
</form>
<!-- End of custom search -->


            <ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">MPC on Jupyter Notebook with Matlab-kernel</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Paulo Loma Marconi
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-09-23T19:17:08-04:00" itemprop="datePublished" title="2020-09-23">2020-09-23</time></a>
            </p>
                <p class="commentline">
        
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/Unconstrained MPC on Jupyter Notebook.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p></p>
<h2>Table of Contents<span class="tocSkip"></span>
</h2>
<div class="toc"><ul class="toc-item">
<li><span><a href="#Unconstrained-Model-Predictive-Control-(MPC)-on-Jupyter-Notebook" data-toc-modified-id="Unconstrained-Model-Predictive-Control-(MPC)-on-Jupyter-Notebook-1"><span class="toc-item-num">1  </span>Unconstrained Model Predictive Control (MPC) on Jupyter Notebook</a></span></li>
<li><span><a href="#Pre-requisites" data-toc-modified-id="Pre-requisites-2"><span class="toc-item-num">2  </span>Pre-requisites</a></span></li>
<li><span><a href="#Background-Theory" data-toc-modified-id="Background-Theory-3"><span class="toc-item-num">3  </span>Background Theory</a></span></li>
<li><span><a href="#Unconstrained-MPC" data-toc-modified-id="Unconstrained-MPC-4"><span class="toc-item-num">4  </span>Unconstrained MPC</a></span></li>
<li><span><a href="#Problem-Formulation" data-toc-modified-id="Problem-Formulation-5"><span class="toc-item-num">5  </span>Problem Formulation</a></span></li>
<li><span><a href="#Prediction-matrices-(predicted-equality-constraint)" data-toc-modified-id="Prediction-matrices-(predicted-equality-constraint)-6"><span class="toc-item-num">6  </span>Prediction matrices (predicted equality constraint)</a></span></li>
<li><span><a href="#Rewriting-the-cost-function" data-toc-modified-id="Rewriting-the-cost-function-7"><span class="toc-item-num">7  </span>Rewriting the cost function</a></span></li>
<li><span><a href="#Substituting-the-predicted-equality-constraint" data-toc-modified-id="Substituting-the-predicted-equality-constraint-8"><span class="toc-item-num">8  </span>Substituting the predicted equality constraint</a></span></li>
<li><span><a href="#Cost-Function-in-QP-compact-form" data-toc-modified-id="Cost-Function-in-QP-compact-form-9"><span class="toc-item-num">9  </span>Cost Function in QP compact form</a></span></li>
<li><span><a href="#Explicit-solution" data-toc-modified-id="Explicit-solution-10"><span class="toc-item-num">10  </span>Explicit solution</a></span></li>
</ul></div>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Unconstrained-Model-Predictive-Control-(MPC)-on-Jupyter-Notebook">Unconstrained Model Predictive Control (MPC) on Jupyter Notebook<a class="anchor-link" href="#Unconstrained-Model-Predictive-Control-(MPC)-on-Jupyter-Notebook">¶</a>
</h2>
<p>The following presents an unconstrained Linear Quadratic Model Predictive Control (LQ-MPC) simulation on Matlab-kernel for Jupyter Notebook. Also, the code files can be used in Matlab natively.</p>
<h2 id="Pre-requisites">Pre-requisites<a class="anchor-link" href="#Pre-requisites">¶</a>
</h2>
<ul>
<li>Knowledge in Control Systems theory.</li>
<li>Convex quadratic optimization theory.</li>
<li>Jupyter Notebook with Matlab-kernel.</li>
<li>Matlab.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Background-Theory">Background Theory<a class="anchor-link" href="#Background-Theory">¶</a>
</h2>
<p>MPC is an optimization-based control strategy that solves a Finite-Horizon Linear Quadratic (FH-LQ) problem subject to constraints. A model of predicted states based on the system dynamics is used to minimize an objective function that satisfies constraints given the actual state. The obtained solution is a sequence of open-loop controls from which only the first one is implemented on the system, inducing feedback. The rest of the sequence is discarded and the process is repeated for the next sampling time, this method is often called Receding-Horizon (RH) principle. Advantages of MPC against other control strategies are the handling of constraints, and non-linearities \cite{Rawlings2009,Rossiter2003}.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In equation $\ref{test}$, we find the value of an
interesting integral:</p>
\begin{equation}\tag{1}
  \int_0^\infty \frac{x^3}{e^x-1}\,dx = \frac{\pi^4}{15}  
\end{equation}
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
$$
\begin{align}
    g &amp;= \int_a^b f(x)dx \tag{1} \\
    a &amp;= b + c \tag{2}
\end{align}
$$<p>See (\ref{1}) and (\ref{2})</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
$$\label{eq:test} 
\begin{align}
M_y(t) &amp;= \mathbb{E} \left( \exp \left[ t^\mathrm{T} (Ax + b) \right] \right) \\
&amp;= \mathbb{E} \left( \exp \left[ t^\mathrm{T} A x \right] \cdot \exp \left[ t^\mathrm{T} b \right] \right) \\
&amp;= \exp \left[ t^\mathrm{T} b \right] \cdot \mathbb{E} \left( \exp \left[ t^\mathrm{T} A x \right] \right) \\
&amp;= \exp \left[ t^\mathrm{T} b \right] \cdot M_x(At) \; .
\end{align}
$$<p>$\eqref{eq:test}$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Unconstrained-MPC">Unconstrained MPC<a class="anchor-link" href="#Unconstrained-MPC">¶</a>
</h2>
<p>Consider the following discrete-time LTI state-space system,
$$
\begin{equation}\label{eq:LTI}
\begin{aligned}
x(k+1) &amp;= A~x(k)+B~u(k)\\
y(k) &amp;= C~x(k),\quad k=0,1,2,\dots
\end{aligned}
\end{equation}
$$
where $x\in\mathbb{R}^n$, $u\in\mathbb{R}^m$, and $y\in\mathbb{R}^p$, are the states, input, and output vectors respectively. $A,~B,~C,$ are the state, input, and output matrices. $A,~B,~C$ are known, no uncertainties in the model, disturbances, and noise. $x(k)$ is available at each sampling time $k$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Problem-Formulation">Problem Formulation<a class="anchor-link" href="#Problem-Formulation">¶</a>
</h2>
<p>The objective is to regulate $x\rightarrow 0$ as $k\rightarrow \infty$ while minimizing the following cost function,</p>
\begin{equation}\label{eq:LQ-MPCu}
\begin{aligned}
J_N(x(k),\mathbf{u}(k)) &amp;= \sum_{j=0}^{N-1} \left( \|x(k+j|k)\|^2_Q + \|u(k+j|k)\|^2_R \right) + \|x(k+N|k)\|^2_P\\
&amp;= \sum_{j=0}^{N-1} (x^\intercal(k+j|k)~Q~x(k+j|k)+ u^\intercal(k+j|k)~R~u(k+j|k) ) + x^\intercal(k+N|k)~P~x(k+N|k) 
\end{aligned}
\end{equation}<p>\hspace{10em}subject to,</p>
\begin{equation}\label{eq:constraints_MPCu}
\begin{aligned}
x(k+1+j|k) &amp;= A~x(k+j|k)+B~u(k+j|k) \\
x(k|k) &amp;= x(k) 
\end{aligned}
\end{equation}<p>\hspace{10em} for $ j=0,1,2,\dots,N-1$\</p>
<p>where $Q\in\mathbb{R}^{n\times n}$ and $R\in\mathbb{R}^{m\times m}$ are the state penalty, and input penalty matrices. $P\in\mathbb{R}^{n\times n}$ is the terminal cost matrix, $N \in\mathbb{N}$ is the horizon length, $k$ is the sampling time, and $(k+j|k)$ can be defined as the next $(k+j)$ value given $k$.</p>
<p>With the value function defined as,
\begin{align}
J^*_N(x(k),\mathbf{u}(k)) &amp;= \min_{u(k)}~ J_N(x(k),\mathbf{u}(k))
\end{align}
the optimal control sequence is,
\begin{equation}\label{eq:optimal_u}
\begin{aligned}
\mathbf{u}^*(k) &amp;= \mathrm{arg}\min_{u(k)}~ J^*_N(x(k),\mathbf{u}(k))\\
&amp;= \left\{ u^*(k|k),u^*(k+1|k),\dots,u^*(k+N-1|k) \right\}
\end{aligned}
\end{equation}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prediction-matrices-(predicted-equality-constraint)">Prediction matrices (predicted equality constraint)<a class="anchor-link" href="#Prediction-matrices-(predicted-equality-constraint)">¶</a>
</h2>
<p>Setting $x(k)=x(k|k)$, and $u(k)=u(k|k)$ and applying the model recursively,
$$
\begin{align*}
x(k+1|k) &amp;= A~x(k)+B~u(k) \\
x(k+2|k) &amp;= A~x(k+1|k)+B~u(k+1|k) \\
                 &amp;= A^2~x(k)+AB~u(k|k)+B~u(k+1|k) \\
\vdots \hspace{2em}  &amp;= \hspace{3em} \vdots \\
x(k+N|k) &amp;= A~x(k+N-1|k)+B~u(k+N-1|k) \\
                 &amp;= A^N~x(k)+A^{N-1}B~u(k|k)+\dots+B~u(k+N-1|k)
\end{align*}
$$</p>
<p>stacking,</p>
$$
\begin{aligned}
{\underbrace{
    \begin{bmatrix}
    x(k+1|k) \\
    x(k+2|k) \\
    \vdots \\
    x(k+N|k)
    \end{bmatrix}}_{\mathbf{x}(k)}
}
=
{\underbrace{
    \begin{bmatrix}
    A \\
    A^2 \\
    \vdots \\
    A^N
    \end{bmatrix}}_{F}
}
+
{\underbrace{
    \begin{bmatrix}
        B        &amp; 0        &amp; \dots  &amp; 0      \\
        AB       &amp; B        &amp; \dots  &amp; 0      \\
        \vdots   &amp; \vdots   &amp; \ddots &amp; \vdots \\
        A^{N-1}B &amp; A^{N-2}B &amp; \dots  &amp; B
    \end{bmatrix}}_{G}
}
{\underbrace{
    \begin{bmatrix}
    u(k|k) \\
    u(k+1|k) \\
    \vdots \\
    u(k+N-1|k)
    \end{bmatrix}}_{\mathbf{u}(k)}
}
\end{aligned}
$$<p>the predicted equality constraint is,
$$
\begin{equation}
\mathbf{x}(k) = F~x(k)+G~\mathbf{u}(k)
\end{equation}
$$
where $\mathbf{x}(k)$, and $\mathbf{u}(k)$ are the state, and input predictions over all steps $j=0,1,2,\dots,N$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Rewriting-the-cost-function">Rewriting the cost function<a class="anchor-link" href="#Rewriting-the-cost-function">¶</a>
</h2>
<p>Rewriting the cost function as,
$$
\begin{aligned}
x^\intercal(k|k)~Q~x(k|k)
&amp;+
\begin{bmatrix}
    x(k+1|k) \\
    x(k+2|k) \\
    \vdots\\
    x(k+N|k) \\
\end{bmatrix}^\intercal
{\underbrace{
    \begin{bmatrix}
        Q      &amp; 0      &amp; \dots  &amp; 0      \\
        0      &amp; Q      &amp; \ddots &amp; \vdots \\
        \vdots &amp; \ddots &amp; Q      &amp; 0      \\
        0      &amp; \dots  &amp; 0      &amp; P
    \end{bmatrix}}_{\tilde{Q}}
}
\begin{bmatrix}
    x(k+1|k) \\
    x(k+2|k) \\
    \vdots\\
    x(k+N|k) \\
\end{bmatrix}
\\
&amp;+
\begin{bmatrix}
    u(k|k) \\
    u(k+1|k) \\
    \vdots \\
    u(k+N-1|k)
\end{bmatrix}^\intercal
{\underbrace{
    \begin{bmatrix}
    R      &amp; 0      &amp; \dots  &amp; 0      \\
    0      &amp; R      &amp; \ddots &amp; \vdots \\
    \vdots &amp; \ddots &amp; R      &amp; 0      \\
    0      &amp; \dots  &amp; 0      &amp; R
        \end{bmatrix}}_{\tilde{R}}
}
\begin{bmatrix}
    u(k|k) \\
    u(k+1|k) \\
    \vdots \\
    u(k+N-1|k)
\end{bmatrix}
\end{aligned}
$$</p>
<p>Therefore, with $x(k|k)=x(k)$, now the problem is to minimize,
$$
\begin{align}
J_N(x(k),\mathbf{u}(k)) &amp;=  x^\intercal(k)~Q~x(k) + \mathbf{x}^\intercal(k)~\tilde{Q}~\mathbf{x}(k) + \mathbf{u}^\intercal(k)~\tilde{R}~\mathbf{u}(k)\\ 
\text{subject to,} \hspace{2em} \\
\mathbf{x}(k) &amp;= F~x(k)+G~\mathbf{u}(k)
\end{align}
$$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Substituting-the-predicted-equality-constraint">Substituting the predicted equality constraint<a class="anchor-link" href="#Substituting-the-predicted-equality-constraint">¶</a>
</h2>$$
\begin{align*}
J_N(x(k),\mathbf{u}(k)) &amp;=  x^\intercal(k) Q x(k) + ( F x(k)+G \mathbf{u}(k) )^\intercal \tilde{Q} ( F x(k)+G \mathbf{u}(k) ) + \mathbf{u}^\intercal(k)~\tilde{R} \mathbf{u}(k) \\
\text{omitting $(k)$ only for the algebraic operations,}\\
&amp;= x^\intercal Q x + [(F x)^\intercal+(G \mathbf{u})^\intercal] \tilde{Q} (F x+G \mathbf{u}) + \mathbf{u}^\intercal \tilde{R} \mathbf{u} \\
&amp;= x^\intercal Q x + (F x)^\intercal \tilde{Q} F x + (F x)^\intercal \tilde{Q} G \mathbf{u} + (G \mathbf{u})^\intercal \tilde{Q} F x + (G \mathbf{u})^\intercal \tilde{Q} G \mathbf{u} + \mathbf{u}^\intercal~\tilde{R} \mathbf{u}\\
&amp;= \underbrace{x^\intercal Q x + x^\intercal F^\intercal \tilde{Q} F x} + \underbrace{x^\intercal F^\intercal \tilde{Q} G \mathbf{u} + \mathbf{u}^\intercal G^\intercal \tilde{Q} F x} + \underbrace{\mathbf{u}^\intercal G^\intercal \tilde{Q} G \mathbf{u} + \mathbf{u}^\intercal \tilde{R} \mathbf{u}}\\
&amp;= x^\intercal(Q+F^\intercal \tilde{Q} F)x \quad \!\!+ \quad 2 \mathbf{u}^\intercal G^\intercal \tilde{Q} F x \qquad\quad+ \mathbf{u}^\intercal (G^\intercal \tilde{Q} G+\tilde{R})\mathbf{u}\\
&amp;= x^\intercal(Q+F^\intercal \tilde{Q} F)x + (2 G^\intercal \tilde{Q} F x)^\intercal \mathbf{u} + \mathbf{u}^\intercal (G^\intercal \tilde{Q} G+\tilde{R})\mathbf{u}\\
&amp;= x^\intercal\underbrace{(Q+F^\intercal \tilde{Q} F)}_M x + (\underbrace{2 G^\intercal \tilde{Q} F}_L x)^\intercal \mathbf{u} + \frac{1}{2}\left[\mathbf{u}^\intercal \underbrace{2(G^\intercal \tilde{Q} G+\tilde{R})}_H \mathbf{u}\right]\\
&amp;= \frac{1}{2}\mathbf{u}(k)^\intercal~H~\mathbf{u}(k)+\underbrace{(L~x(k))^\intercal}_{c^\intercal}~\mathbf{u}(k)+\underbrace{x(k)^\intercal~M~x(k)}_\alpha
\end{align*}
$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Cost-Function-in-QP-compact-form">Cost Function in QP compact form<a class="anchor-link" href="#Cost-Function-in-QP-compact-form">¶</a>
</h2>$$
\begin{align}
J_N(x(k),\mathbf{u}(k)) &amp;= \frac{1}{2} \mathbf{u}(k)^\intercal~H~\mathbf{u}(k)+c^\intercal~\mathbf{u}(k)+\alpha \\
\text{where,} \hspace{3em} \\
H&amp;=2(G^\intercal\tilde{Q}G+\tilde{R})\\
c&amp;=L~x(k) \\
L&amp;=2G^\intercal\tilde{Q}F\\
\alpha&amp;=x^\intercal(k)~M~x(k) \\
M&amp;=Q+F^\intercal\tilde{Q}F
\end{align}
$$
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Explicit-solution">Explicit solution<a class="anchor-link" href="#Explicit-solution">¶</a>
</h2>
<p>Minimizing with the gradient and solving for $\mathbf{u}^*(k)$,</p>
$$
\begin{align}
J^*_N(x(k),\mathbf{u}(k)) &amp;= \min_{\mathbf{u}(k)}~\frac{1}{2} \mathbf{u}(k)^\intercal~H~\mathbf{u}(k)+c^\intercal~\mathbf{u}+\alpha \\ 
\nabla_\mathbf{u}~J^*_N(x(k),\mathbf{u}(k)) &amp;= 0 \\
H~\mathbf{u}^*(k)+c &amp;= 0 \\
\mathbf{u}^*(k) &amp;= -H^{-1}~c \\
\text{the optimal solution results in,} \hspace{5em} \\
\mathbf{u}^*(k) &amp;= -H^{-1}~L~x(k)
\end{align}
$$<p>where that $Q\succeq,~P\succeq 0$ are positive semidefinite convex, and $R\succ 0$ is definite convex, such that $H\succ 0$. The optimal solution $\mathbf{u}^*(k)$ for any $x(k)$ is unique if $H\succ 0$ is invertible.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Applying the RH principle means that only the \textbf{first} control input of the vector \eqref{eq:opt_mpc_u} is applied to the real system. That is,
$$
\begin{align}
\begin{bmatrix}
    u^*(k) \\
    u^*(k+1) \\
    \vdots \\
    u^*(k+N-1)
\end{bmatrix}
&amp;=
\begin{bmatrix}
    I      &amp; 0      &amp; 0      &amp; \dots  &amp; 0      \\
    0      &amp; I      &amp; 0      &amp; \dots  &amp; 0      \\
    \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
    0      &amp; 0      &amp; 0      &amp; \dots  &amp; I
\end{bmatrix}
(-H^{-1}~L)x(k)
\end{align}
$$</p>
$$
\begin{align}
u^*(k) &amp;= K_N~x(k)\\
K_N &amp;= [I \quad 0 \quad 0 \quad \dots \quad 0](-H^{-1}~L)
\end{align}
$$<p>Notice that $u^*(k)$ is an explicit linear time-invariant control law because $H$ and $L$ do not depend on $x(k)$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
\begin{align}\label{eq:test2}
u^*(k) &amp;= K_N~x(k)\\
K_N &amp;= [I \quad 0 \quad 0 \quad \dots \quad 0](-H^{-1}~L)
\end{align}<p>Notice that $u^*(k)$ is an explicit linear time-invariant control law because $H$ and $L$ do not depend on $x(k)$. \eqref{eq:test2}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [ ]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-matlab"><pre><span></span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../MPC-SSTO/" rel="prev" title="MPC with feed-forward SSTO">Previous post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="paulomarconi",
            disqus_url="https://paulomarconi.github.io/blog/MPC/",
        disqus_title="MPC on Jupyter Notebook with Matlab-kernel",
        disqus_identifier="cache/posts/Unconstrained MPC on Jupyter Notebook.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    },
    TeX: { 
        equationNumbers: { 
            autoNumber: "all", // AMS, all, none            
            useLabelIds: true,             
        } 
    }
});
MathJax.Hub.Queue(
  ["resetEquationNumbers", MathJax.InputJax.TeX],
  ["PreProcess", MathJax.Hub],
  ["Reprocess", MathJax.Hub]
);
</script></article><script>var disqus_shortname="paulomarconi";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script><!--End of body content--><footer id="footer"><div class="text-center">
    <p>
        <span class="fa-stack fa-2x">
        <a href="https://github.com/paulomarconi">
            <i class="fa fa-github-square fa-stack-2x"></i>
        </a>
        </span>
        <!--
        <span class="fa-stack fa-2x">
        <a href="https://scholar.google.com/citations?user=ID">
            <i class="ai ai-google-scholar-square ai-2x"></i>
        </a>
        </span>
        -->
        <span class="fa-stack fa-2x">
        <a href="https://www.linkedin.com/in/paulomarconi">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-linkedin fa-inverse fa-stack-1x"></i>
        </a>
        </span>
        <span class="fa-stack fa-2x">
        <a href="mailto:prlomarconi@gmail.com">
            <i class="fa fa-square fa-stack-2x"></i>
            <i class="fa fa-envelope fa-inverse fa-stack-1x"></i>
        </a>
        </span>
    </p>
    <p>
        
<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
<img alt="Creative Commons License BY-NC-SA" style="border-width:0; margin-bottom:12px;" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"></a> Contents © 2020  <a href="mailto:prlomarconi@gmail.com">Paulo Loma Marconi</a> - Powered by <a href="https://getnikola.com" rel="nofollow">Nikola</a> 
    </p>
</div>

            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script><script src="../../assets/js/prism.js"></script>
</body>
</html>
